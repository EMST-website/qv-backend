# name: CI/CD Pipeline

# on:
#     push:
#         branches: [main, staging]
#     pull_request:
#         branches: [main, staging]

# jobs:
#   test-and-build:
#     name: Test
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4


#     services:
#       postgres:
#         image: postgres:15
#         env:
#           POSTGRES_USER: test_user
#           POSTGRES_PASSWORD: test_password
#           POSTGRES_DB: test_db
#         options: >-
#           --health-cmd pg_isready
#           --health-interval 10s
#           --health-timeout 5s
#           --health-retries 5
#         ports:
#           - 5432:5432

#       redis:
#         image: redis:7-alpine
#         options: >-
#           --health-cmd "redis-cli ping"
#           --health-interval 10s
#           --health-timeout 5s
#           --health-retries 5
#         ports:
#           - 6379:6379

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'

#       - name: Install dependencies
#         run: npm ci

#       - name: Verify ESLint configuration
#         run: |
#           echo "Checking ESLint configuration..."
#           npx eslint --print-config src/main.ts > /dev/null

#       - name: Run ESLint
#         run: npm run lint

#       - name: Run unit tests
#         env:
#           DATABASE_URL: postgresql://test_user:test_password@localhost:5432/test_db
#           REDIS_HOST: localhost
#           REDIS_PORT: 6379
#           JWT_SECRET: test-jwt-secret
#           JWT_ACCESS_TOKEN_SECRET: test-access-secret
#           JWT_REFRESH_TOKEN_SECRET: test-refresh-secret
#           JWT_ACCESS_TOKEN_EXPIRY: 15m
#           JWT_REFRESH_TOKEN_EXPIRY: 7d
#           EMAIL_HOST: smtp.test.com
#           EMAIL_PORT: 587
#           EMAIL_USER: test@test.com
#           EMAIL_PASSWORD: test-password
#           EMAIL_FROM: noreply@test.com
#           NODE_ENV: test
#         run: npm run test

#       - name: Run e2e tests
#         env:
#           DATABASE_URL: postgresql://test_user:test_password@localhost:5432/test_db
#           REDIS_HOST: localhost
#           REDIS_PORT: 6379
#           JWT_SECRET: test-jwt-secret
#           JWT_ACCESS_TOKEN_SECRET: test-access-secret
#           JWT_REFRESH_TOKEN_SECRET: test-refresh-secret
#           JWT_ACCESS_TOKEN_EXPIRY: 15m
#           JWT_REFRESH_TOKEN_EXPIRY: 7d
#           EMAIL_HOST: smtp.test.com
#           EMAIL_PORT: 587
#           EMAIL_USER: test@test.com
#           EMAIL_PASSWORD: test-password
#           EMAIL_FROM: noreply@test.com
#           NODE_ENV: test
#         run: npm run test:e2e

#       - name: Build application
#         run: npm run build

#       - name: Check build output
#         run: |
#           if [ ! -d "dist" ]; then
#             echo "Build failed: dist directory not found"
#             exit 1
#           fi
#           echo "Build successful: dist directory created"
#           ls -la dist/

#       - name: Run TypeScript type check
#         run: npx tsc --noEmit

#   status-check:
#     name: All Checks Passed
#     runs-on: ubuntu-latest
#     needs: [test-and-build]
#     if: always()
#     steps:
#       - name: Check if all jobs passed
#         run: |
#           if [ "${{ needs.test-and-build.result }}" != "success" ]; then
#             echo "One or more checks failed. Cannot merge."
#             exit 1
#           fi
#           echo "All checks passed successfully! âœ…"
